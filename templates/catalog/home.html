{% extends 'base.html' %}
{% load static humanize %}
{% block content %}

<link rel="stylesheet" href="{% static 'css/uzbek.css' %}">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">

<style>
/* Kartochkadagi rasm qirqilmasin, kvadratga yaqin karta */
.product-card {
    border-radius: 16px;
}
.product-card .card-body {
    border-radius: 0 0 16px 16px;
}
.product-card .card-img-top {
    border-radius: 16px 16px 0 0;
    height: 220px;
    aspect-ratio: 1 / 1;
    object-fit: contain;
    background: #fafafa;
    padding: 6px;
}
</style>

<!-- === FILTER BOX (NAVBAR tugmasi bilan ochiladi) === -->
<div id="filterBox" class="accordion mb-3 filter-section uzbek-card d-none">
  <div class="accordion-item">

    <!-- ❌ "Qidiruv / Filter" sarlavhasi olib tashlandi -->

    <div id="collapseOne" class="accordion-collapse collapse" data-bs-parent="#filterBox">
      <div class="accordion-body filter-block">

        <form method="get" class="row g-2">

          <!-- Kategoriya -->
          <div class="col-md-2">
            <select name="category" class="form-select filter-input uzbek-input">
              <option value="">Katalog</option>
              {% for c in categories %}
              <option value="{{ c.slug }}">
                {% if c.name == "Ijod namunalari" %}
                    Mahsulotlar
                {% else %}
                    {{ c.name }}
                {% endif %}
              </option>
              {% endfor %}
            </select>
          </div>

          <!-- Min narx -->
          <div class="col-6 col-md-2">
            <input type="number" step="0.01" name="min_price" class="form-control filter-input uzbek-input" placeholder="Min narx">
          </div>

          <!-- Max narx -->
          <div class="col-6 col-md-2">
            <input type="number" step="0.01" name="max_price" class="form-control filter-input uzbek-input" placeholder="Max narx">
          </div>

          <!-- Reyting -->
          <div class="col-md-1">
            <select name="rating_gte" class="form-select filter-input uzbek-input">
              <option value="">Reyting ≥</option>
              {% for i in '12345' %}
              {% with v=forloop.counter %}
              <option value="{{ v }}">{{ v }}</option>
              {% endwith %}
              {% endfor %}
            </select>
          </div>

          <!-- Saralash -->
          <div class="col-md-2">
            <select name="order_by" class="form-select filter-input uzbek-input">
              <option value="">Saralash</option>
              <option value="-date">Yangi</option>
              <option value="price">Narx ↑</option>
              <option value="-price">Narx ↓</option>
              <option value="-rating">Reyting</option>
            </select>
          </div>

          <!-- Qidirish + Tozalash tugmalari (ENDI BIR QATORDA!) -->
          <div class="col-md-3 d-flex gap-2">
            <button class="btn btn-gradient search-btn w-100">
              <i class="bi bi-search me-2"></i> Qidirish
            </button>

            <button type="reset" class="btn btn-outline-secondary w-100">
              <i class="bi bi-arrow-clockwise me-2"></i> Tozalash
            </button>
          </div>

        </form>

      </div>
    </div>

  </div>
</div>

<!-- SEPARATOR -->
<div class="uzbek-separator my-4"></div>

<!-- === PRODUCT CARDS GRID === -->
<div id="cardsGrid" class="row g-3">

  {% if page_obj %}
    {% for art in page_obj %}
      <div class="col-6 col-sm-6 col-md-4 col-lg-3 card-item">
        <div class="product-card h-100 shadow-sm uzbek-product-card">

          {% if art.first_image_url %}
            <img src="{{ art.first_image_url }}" class="card-img-top cover" alt="{{ art.title }}" loading="lazy">
          {% else %}
            <div class="placeholder-bg uzbek-placeholder">
              <i class="bi bi-image me-2"></i>ARTAR
            </div>
          {% endif %}

          <div class="card-body d-flex flex-column p-3">
            <h5 class="card-title mb-1 text-truncate uzbek-title" title="{{ art.title }}">
              {{ art.title }}
            </h5>

            <div class="mb-3 price uzbek-price">
              Narx: <strong>{{ art.price|floatformat:0|intcomma }}</strong> so'm
            </div>

            {% if art.slug %}
            <a href="{% url 'catalog:detail' art.slug %}" class="btn btn-gradient view-btn mt-auto">
              <i class="bi bi-eye me-2"></i> Ko'rish
            </a>
            {% else %}
            <button class="btn btn-secondary mt-auto" disabled>
              <i class="bi bi-exclamation-circle me-2"></i> Slug yo‘q
            </button>
            {% endif %}
          </div>

        </div>
      </div>
    {% endfor %}

  {% else %}
    <div class="col-12 text-center py-5">
      <div class="uzbek-empty-state">
        <i class="bi bi-inbox display-1 text-muted mb-3"></i>
        <h4 class="text-muted">Hech narsa topilmadi</h4>
        <p class="text-muted">Boshqa filterlar bilan qayta urinib ko‘ring</p>
      </div>
    </div>
  {% endif %}
</div>

<!-- PAGINATION -->
<div class="d-flex justify-content-center align-items-center gap-2 my-4">
  <button id="prevPage" class="btn btn-outline-primary">
    <i class="bi bi-chevron-left me-1"></i> Oldingi
  </button>

  <span id="pageIndicator" class="text-muted small"></span>

  <button id="nextPage" class="btn btn-gradient">
    Keyingi<i class="bi bi-chevron-right ms-1"></i>
  </button>

  <input type="hidden" id="pageSize" value="12">
</div>

<!-- JS FILES -->
<script defer src="{% static 'js/uzbek-autoclasses.js' %}"></script>
<script defer src="{% static 'js/uzbek-stars.js' %}"></script>
<script defer src="{% static 'js/client-pagination.js' %}"></script>

{% endblock %}
